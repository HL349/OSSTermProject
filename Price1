import os
import cv2
import pytesseract
from PIL import Image

# Tesseract 경로 설정 (필요시 수정)
pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'

# 기본 이미지 경로 템플릿
image_path_template = r"C:\Users\mousy\TermProjectTest\Price\Price{}.png"

N = 1

while True:
    # 현재 N값을 이미지 경로에 적용
    image_path = image_path_template.format(N)
    
    # 파일 존재 여부 확인
    if os.path.exists(image_path):
        # 파일이 존재하면 이미지를 읽고 출력
        img = cv2.imread(image_path)
        
        # 이미지가 잘못 읽혔을 경우 오류 방지
        if img is None:
            print(f"Failed to load image at {image_path}")
            break
        
        # 이미지 출력
        cv2.imshow(f'Image {N}', img)
        cv2.waitKey(0)  # 키 입력 대기
        cv2.destroyAllWindows()  # 윈도우 닫기
        
        # 이미지 전처리
        img_gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
        blur = cv2.GaussianBlur(img_gray, (3, 3), 0)
        canny = cv2.Canny(blur, 100, 200)
        contours, hierarchy = cv2.findContours(canny, cv2.RETR_TREE, cv2.CHAIN_APPROX_SIMPLE)
        
        for cnt in contours:
            x, y, w, h = cv2.boundingRect(cnt)
            cropped = img_gray[y:y+h, x:x+w]
            text = pytesseract.image_to_string(cropped, lang='kor')
            if text.strip():  # 텍스트가 있는 경우에만 출력
                print('Detected text:', text)
        
        # N값을 증가
        N += 1
    else:
        # 파일이 존재하지 않으면 루프 종료
        print(f"No more images found at N={N}.")
        break
